# CV/ML –ò–Ω–∂–µ–Ω–µ—Ä - –ó–∞–¥–∞—á–∏ –ø–æ –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö

## üìã –û–±–∑–æ—Ä –∑–∞–¥–∞—á–∏

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –¥–µ—Ç–µ–∫—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–µ–π, –ø–µ—á–∞—Ç–µ–π –∏ QR-–∫–æ–¥–æ–≤ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º YOLOv8/YOLOv11.

## üéØ –¶–µ–ª–∏

1. –û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å object detection –Ω–∞ 3 –∫–ª–∞—Å—Å–∞:
   - `signature` (–ø–æ–¥–ø–∏—Å–∏)
   - `stamp` (–ø–µ—á–∞—Ç–∏)
   - `qr_code` (QR-–∫–æ–¥—ã)

2. –û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –¥–µ—Ç–µ–∫—Ü–∏–∏:
   - –ú–∏–Ω–∏–º—É–º –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π
   - –í—ã—Å–æ–∫–∏–π recall (–Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã)
   - –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ confidence –∏ NMS

3. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π inference-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç:
   - –û–±—É—á–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ –º–æ–¥–µ–ª–∏ (`best.pt`)
   - Python-–æ–±—ë—Ä—Ç–∫—É –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
   - REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üìä –≠—Ç–∞–ø 1: –ê–Ω–∞–ª–∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞

### –ó–∞–¥–∞—á–∏:

1. **–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞:**
   ```bash
   python router/object-detection-service/scripts/analyze_dataset.py \
     /path/to/your/dataset \
     --output dataset_analysis.json
   ```

2. **–ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:**
   - [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ –∫–ª–∞—Å—Å–∞–º
   - [ ] –ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ (—Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ signature:stamp:qr_code)
   - [ ] –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (min/max/avg)
   - [ ] –§–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤ (JPEG, PNG)
   - [ ] –†–∞–∑–º–µ—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤ (bbox dimensions)
   - [ ] Aspect ratio –æ–±—ä–µ–∫—Ç–æ–≤
   - [ ] –ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

3. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
   - –¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–¥–æ–≥–æ–≤–æ—Ä—ã, –∞–∫—Ç—ã, —Å–ø—Ä–∞–≤–∫–∏, etc.)
   - –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –ø–µ—á–∞—Ç–µ–π (–∫—Ä—É–≥–ª—ã–µ, –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—ã–µ, —Ü–≤–µ—Ç–Ω—ã–µ)
   - –í–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–µ–π (—Ä—É–∫–æ–ø–∏—Å–Ω—ã–µ, —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
   - –¢–∏–ø—ã QR-–∫–æ–¥–æ–≤ (—Ä–∞–∑–º–µ—Ä—ã, –∫–∞—á–µ—Å—Ç–≤–æ)

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞:

- ‚úÖ **–ú–∏–Ω–∏–º—É–º 500-1000 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –Ω–∞ –∫–ª–∞—Å—Å
- ‚úÖ **–ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤:** —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ < 3:1
- ‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:** —Å—Ä–µ–¥–Ω–µ–µ > 1000x1000 –ø–∏–∫—Å–µ–ª–µ–π
- ‚úÖ **–†–∞–∑–º–µ—Ä –æ–±—ä–µ–∫—Ç–æ–≤:** —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –æ—Ç –º–µ–ª–∫–∏—Ö –¥–æ –∫—Ä—É–ø–Ω—ã—Ö
- ‚ö†Ô∏è **–ï—Å–ª–∏ –º–µ–Ω—å—à–µ:** –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏—é

## üìù –≠—Ç–∞–ø 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –ó–∞–¥–∞—á–∏:

1. **–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤ YOLO —Ñ–æ—Ä–º–∞—Ç** (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è):
   
   **–ò–∑ COCO:**
   ```bash
   python router/object-detection-service/scripts/convert_annotations.py \
     --format coco \
     --input annotations.json \
     --images /path/to/images \
     --output dataset_yolo \
     --split
   ```

   **–ò–∑ Pascal VOC:**
   ```bash
   python router/object-detection-service/scripts/convert_annotations.py \
     --format voc \
     --input /path/to/annotations \
     --images /path/to/images \
     --output dataset_yolo \
     --split
   ```

   **–ò–∑ LabelMe:**
   ```bash
   python router/object-detection-service/scripts/convert_annotations.py \
     --format labelme \
     --input /path/to/labelme_jsons \
     --output dataset_yolo \
     --split
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç YOLO:**
   
   –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞:
   ```
   dataset_yolo/
   ‚îú‚îÄ‚îÄ train/
   ‚îÇ   ‚îú‚îÄ‚îÄ images/
   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ doc1.jpg
   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
   ‚îÇ   ‚îî‚îÄ‚îÄ labels/
   ‚îÇ       ‚îú‚îÄ‚îÄ doc1.txt
   ‚îÇ       ‚îî‚îÄ‚îÄ ...
   ‚îú‚îÄ‚îÄ val/
   ‚îÇ   ‚îú‚îÄ‚îÄ images/
   ‚îÇ   ‚îî‚îÄ‚îÄ labels/
   ‚îî‚îÄ‚îÄ test/
       ‚îú‚îÄ‚îÄ images/
       ‚îî‚îÄ‚îÄ labels/
   ```

   –§–æ—Ä–º–∞—Ç `.txt` (YOLO):
   ```
   0 0.512 0.345 0.123 0.089  # class x_center y_center width height (normalized)
   1 0.678 0.567 0.234 0.156
   ```

3. **Mapping –∫–ª–∞—Å—Å–æ–≤:**
   ```
   0: signature
   1: stamp
   2: qr_code
   ```

## üéì –≠—Ç–∞–ø 3: –í—ã–±–æ—Ä –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏

### –ó–∞–¥–∞—á–∏:

1. **–í—ã–±—Ä–∞—Ç—å —Ä–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏ YOLOv8:**
   
   | –ú–æ–¥–µ–ª—å | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –°–∫–æ—Ä–æ—Å—Ç—å | –¢–æ—á–Ω–æ—Å—Ç—å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
   |--------|-----------|----------|----------|---------------|
   | YOLOv8n | 3.2M | –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ | –°—Ä–µ–¥–Ω—è—è | Mobile/Edge |
   | YOLOv8s | 11.2M | –ë—ã—Å—Ç—Ä–æ | –•–æ—Ä–æ—à–∞—è | CPU inference |
   | **YOLOv8m** | **25.9M** | **–°—Ä–µ–¥–Ω–µ** | **–í—ã—Å–æ–∫–∞—è** | **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** |
   | YOLOv8l | 43.7M | –ú–µ–¥–ª–µ–Ω–Ω–æ | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | GPU, –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
   | YOLOv8x | 68.2M | –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è | Production GPU |

   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å **YOLOv8m** –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ —Å–∫–æ—Ä–æ—Å—Ç—å/–∫–∞—á–µ—Å—Ç–≤–æ.

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ultralytics:**
   ```bash
   pip install ultralytics
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å GPU (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω):**
   ```python
   import torch
   print(torch.cuda.is_available())
   print(torch.cuda.get_device_name(0))
   ```

## üî¨ –≠—Ç–∞–ø 4: –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

### –ë–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ:

```bash
python router/object-detection-service/scripts/train_model.py \
  --train dataset_yolo/train/images \
  --val dataset_yolo/val/images \
  --model yolov8m.pt \
  --epochs 100 \
  --batch 16 \
  --imgsz 640 \
  --device 0 \
  --name document_detector_v1
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤:

1. **–†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (`--imgsz`):**
   - 640 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç, –±—ã—Å—Ç—Ä–æ)
   - 1024 (–¥–ª—è –º–µ–ª–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
   - 1280 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)

2. **–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (`--batch`):**
   - 8 (GPU 4-6 GB)
   - 16 (GPU 8-12 GB)
   - 32 (GPU 16+ GB)
   - -1 (auto batch size)

3. **Epochs:**
   - –ú–∏–Ω–∏–º—É–º: 50-100
   - –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 100-200
   - Early stopping: `--patience 50`

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è:

–ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –º–µ—Ç—Ä–∏–∫–∞–º–∏:
- **mAP@0.5** (main metric)
- **Precision**
- **Recall**
- **F1-Score**

–ì—Ä–∞—Ñ–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤: `runs/detect/document_detector_v1/results.png`

### –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ú–∏–Ω–∏–º—É–º | –¶–µ–ª—å | –û—Ç–ª–∏—á–Ω–æ |
|---------|---------|------|---------|
| mAP@0.5 | 0.75 | 0.85 | 0.90+ |
| Precision | 0.80 | 0.85 | 0.90+ |
| Recall | 0.75 | 0.80 | 0.85+ |

## ‚öôÔ∏è –≠—Ç–∞–ø 5: –ü–æ–¥–±–æ—Ä –ø–æ—Ä–æ–≥–æ–≤

### –ó–∞–¥–∞—á–∏:

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–º –Ω–∞–±–æ—Ä–µ:**
   ```python
   from ultralytics import YOLO
   
   model = YOLO("runs/detect/document_detector_v1/weights/best.pt")
   metrics = model.val(
       data="data.yaml",
       conf=0.25,  # –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
       iou=0.4
   )
   ```

2. **–ù–∞–π—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π confidence threshold:**
   
   –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   ```python
   for conf in [0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5]:
       metrics = model.val(conf=conf)
       print(f"Conf {conf}: mAP={metrics.box.map:.3f}, "
             f"P={metrics.box.p:.3f}, R={metrics.box.r:.3f}")
   ```

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å NMS threshold:**
   
   –†–µ–≥—É–ª–∏—Ä—É–µ—Ç –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è –±–æ–∫—Å–æ–≤:
   ```python
   for iou in [0.3, 0.4, 0.5, 0.6, 0.7]:
       metrics = model.val(iou=iou)
       print(f"IoU {iou}: Duplicates, precision")
   ```

4. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   
   –í `router/object-detection-service/app/config.py`:
   ```python
   MODEL_CONFIG = {
       "confidence_threshold": 0.35,  # –ù–∞–π–¥–µ–Ω–Ω–æ–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ
       "nms_threshold": 0.4,          # –ù–∞–π–¥–µ–Ω–Ω–æ–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ
       ...
   }
   
   CLASS_THRESHOLDS = {
       "signature": 0.35,  # –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞
       "stamp": 0.40,
       "qr_code": 0.45
   }
   ```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–±–æ—Ä–∞ –ø–æ—Ä–æ–≥–æ–≤:

- **–ú–∏–Ω–∏–º—É–º False Positives:** –£–≤–µ–ª–∏—á–∏—Ç—å confidence
- **–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã:** –£–º–µ–Ω—å—à–∏—Ç—å confidence
- **–î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –±–æ–∫—Å—ã:** –£–º–µ–Ω—å—à–∏—Ç—å NMS threshold
- **–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –±–ª–∏–∑–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã:** –£–≤–µ–ª–∏—á–∏—Ç—å NMS threshold

## üì¶ –≠—Ç–∞–ø 6: –í—ã–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

### –ó–∞–¥–∞—á–∏:

1. **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ–±—É—á–µ–Ω–Ω—ã–µ –≤–µ—Å–∞:**
   ```bash
   cp runs/detect/document_detector_v1/weights/best.pt \
      router/object-detection-service/models/best.pt
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å inference wrapper:**
   ```python
   from router.object_detection_service.app.detector import ObjectDetector
   from PIL import Image
   
   detector = ObjectDetector()
   image = Image.open("test_document.jpg")
   detections = detector.detect(image)
   
   print(f"Detections: {len(detections)}")
   for det in detections:
       print(f"  {det['label']}: {det['confidence']:.2f} at {det['bbox']}")
   ```

3. **–§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
   ```json
   [
     {
       "page": 0,
       "label": "signature",
       "bbox": [100.5, 200.3, 250.8, 280.1],
       "confidence": 0.8532
     },
     {
       "page": 0,
       "label": "stamp",
       "bbox": [50.2, 150.6, 180.4, 220.9],
       "confidence": 0.9241
     }
   ]
   ```

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:**
   ```bash
   # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
   cd router/object-detection-service
   python -m app.main
   
   # –¢–µ—Å—Ç
   curl -X POST "http://localhost:8007/detect" \
     -F "file=@test_doc.jpg" \
     -F "page_number=0"
   ```

## üìà –≠—Ç–∞–ø 7: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏–µ

### –ï—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã:

1. **–£–≤–µ–ª–∏—á–∏—Ç—å –¥–∞—Ç–∞—Å–µ—Ç:**
   - –°–æ–±—Ä–∞—Ç—å –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö
   - –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è (rotation, brightness, contrast)
   - Synthetic data generation

2. **–£–ª—É—á—à–∏—Ç—å —Ä–∞–∑–º–µ—Ç–∫—É:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
   - –ü–µ—Äe—Ä–∞–∑–º–µ—Ç–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏
   - –î–æ–±–∞–≤–∏—Ç—å hard negatives

3. **–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏:**
   ```bash
   python scripts/train_model.py ... --model yolov8l.pt
   ```

4. **–£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
   ```bash
   python scripts/train_model.py ... --imgsz 1024
   ```

5. **Multi-scale training:**
   ```bash
   python scripts/train_model.py ... --imgsz 640 --multi-scale
   ```

6. **–î–æ–æ–±—É—á–µ–Ω–∏–µ (fine-tuning):**
   ```bash
   python scripts/train_model.py \
     --model runs/detect/document_detector_v1/weights/best.pt \
     --epochs 50 \
     --name document_detector_v2
   ```

## üß™ –≠—Ç–∞–ø 8: –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –¢–µ—Å—Ç–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç:

- [ ] –¢–µ—Å—Ç –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –∏–∑ `uploads/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- [ ] –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–¥–æ–≥–æ–≤–æ—Ä—ã, –∞–∫—Ç—ã, —Å–ø—Ä–∞–≤–∫–∏)
- [ ] –†–∞–∑–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –†–∞–∑–Ω—ã–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ (portrait/landscape)
- [ ] –ú–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–¥–ø–∏—Å—è–º–∏/–ø–µ—á–∞—Ç—è–º–∏
- [ ] Edge cases: —Ä–∞–∑–º—ã—Ç—ã–µ, –Ω–∏–∑–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, –ø–æ–¥ —É–≥–ª–æ–º

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è production:

- **Precision:** > 0.90 (–º–∏–Ω–∏–º—É–º –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π)
- **Recall:** > 0.85 (–Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤–∞–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã)
- **Inference time:** < 500ms –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (CPU) –∏–ª–∏ < 100ms (GPU)

## üìã –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç CV/ML –∏–Ω–∂–µ–Ω–µ—Ä–∞

### –ê–Ω–∞–ª–∏–∑:
- [ ] –î–∞—Ç–∞—Å–µ—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –û—Ü–µ–Ω–µ–Ω–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
- [ ] –í—ã—è–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–ª—É—á–∞–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
- [ ] –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤ YOLO —Ñ–æ—Ä–º–∞—Ç–µ
- [ ] –î–∞—Ç–∞—Å–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ train/val/test (80/10/10)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤

### –û–±—É—á–µ–Ω–∏–µ:
- [ ] –í—ã–±—Ä–∞–Ω —Ä–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è YOLOv8m)
- [ ] –ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ (epochs ‚â• 100)
- [ ] –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã —Ü–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (mAP@0.5 > 0.85)

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
- [ ] –ü–æ–¥–æ–±—Ä–∞–Ω confidence threshold (0.25-0.45)
- [ ] –ü–æ–¥–æ–±—Ä–∞–Ω NMS threshold (0.3-0.5)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã CLASS_THRESHOLDS –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:
- [ ] –í–µ—Å–∞ –º–æ–¥–µ–ª–∏: `models/best.pt`
- [ ] Inference wrapper: `app/detector.py`
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `app/config.py`
- [ ] FastAPI —Å–µ—Ä–≤–∏—Å: `app/main.py`
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `README.md`

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
- [ ] API –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8007
- [ ] Endpoint `/detect` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–∞: `[{page, label, bbox, confidence}]`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö

## üöÄ –ó–∞–ø—É—Å–∫ –≤ production

1. **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å:**
   ```bash
   cp runs/detect/document_detector_v1/weights/best.pt \
      router/object-detection-service/models/
   ```

2. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** –≤ `app/config.py`

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å:**
   ```bash
   cd router/object-detection-service
   uvicorn app.main:app --host 0.0.0.0 --port 8007
   ```

4. **–î–æ–±–∞–≤–∏—Ç—å –≤ docker-compose** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   ```yaml
   object-detection-service:
     build: ./router/object-detection-service
     ports:
       - "8007:8007"
     volumes:
       - ./router/object-detection-service/models:/app/models
   ```

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ:
- –ö–∞—á–µ—Å—Ç–≤—É –¥–µ—Ç–µ–∫—Ü–∏–∏
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ pipeline

–û–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ issue.

---

**–£—Å–ø–µ—Ö–æ–≤ –≤ –æ–±—É—á–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏! üéØ**
